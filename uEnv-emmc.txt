bootm_size=0x10000000
console=ttyS2,115200n8
fit_addr=0x88000000
bootlimit=3
system_dev=1
system_part=2
upgrade_available=0
ustate=0

swap_part=if test ${system_part} = 2; then \
    setenv system_part 3; \
  else \
    setenv system_part 2; \
  fi; \
  env save
check_upgrade=if test ${upgrade_available} = 1 -a ${bootcount} = 1; then \
    run swap_part; \
    run set_success; \
  fi
clear_upgrade=setenv upgrade_available 0; setenv bootcount 0; env save
set_success=setenv ustate 2; env save
set_error=setenv ustate 3; env save
set_mmcroot=setenv mmcroot /dev/mmcblk${system_dev}p${system_part}
set_bootargs=setenv bootargs console=${console} panic=3 root=${mmcroot} rootwait rw

bootcmd=run check_upgrade; run set_mmcroot; run set_bootargs;\
  ext4load mmc ${system_dev}:${system_part} ${fit_addr} /boot/fitImage.itb; \
  bootm ${fit_addr}
altbootcmd=run swap_part; run clear_upgrade; run set_error; run bootcmd
